flowchart TB
    A[/API request/] --> B{Authenticated?}
    B --NO--> C([Return 401 Unauthorized HTTP status])
    B --YES--> D[/Append client ID to the long URL\]
    D --> E{{Produce MD5 hash of the client ID + URL}}
    E --> F{{Encode the hash in base64}}
    F --> G{{Pick 6 random characters as short code}}
    G --> H[[Insert short code, long URL and client ID into DB]]
    H --> I{Did insert work?}
    I --NO -> short code already exists--> G
    I --YES--> J([Return 201 Created HTTP status with short URL in response body])
